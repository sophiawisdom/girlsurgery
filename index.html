<html>
    <head>
        <meta charset="utf-8">
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Lato:wght@400;700;900&family=Courier+New&display=swap" rel="stylesheet">
        <style>
#lex-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 300px;
    margin: 0 auto;
    text-align: center;
}

#lex h3 {
    padding: 0px;
    margin-top: 10px;
    margin-bottom: 0px;
}

#lex p {
    padding: 0px;
    margin: 0px;
    width: 100%;
}

.columns {
    display: flex;
    justify-content: space-between;
    gap: 20px; 
}
.column {
    flex: 1;
}
.column p {
    margin: 0px;
}
a {
    text-decoration: none;
}
.name {
    color: #20a6df;
}
.age {
    color: red;
    font-weight: bold;
}
.monasticism {
    font-weight: bold;
    transition: color 150ms;
    transition: font-size 150ms;
    color: #002D72;
}

body:has(.monasticism:hover) .monasticism {
    font-size: larger;
    color: #3C6FD1;
}
        </style>
        <title> sophism </title>
    </head>
    <canvas style="margin: 0px;" id="love" style="width:1710px; height:40px;">
    </canvas>
    <!-- replacement for user-agent body 8px margin-->
    <div style="margin:8px">

    <p style="font-size:30px; justify-content: center; text-align: center; display:flex; margin-top: 15px; margin-bottom: 10px;"> I am&nbsp;<span class="name">Sophia</span>. This is my blog.

    <div class="columns">

        <div style="flex: 1.5; width: 50px;">

    <p style="margin: 0px;"> I live in San Francisco, in the mission district. I'm working on gathering datasets and selling them to LLM companies. Reach out for more info at sophia@calaveras.ai. </p>
    <p style="margin-top: 0px;"> I <a href="https://twitter.com/cis_female"> have a twitter</a>. <a href="mailto:spam@girl.surgery" class="email" style="text-decoration: none;">i can be emailed</a>. </p>
        </div>

    <div class="column">
        <p style="margin: 0px;"><a style="font-size:25px;" href="/website_vibes/index.html"> i uploaded some of my screenshots </a>. <a href="/facts.html"> i'm assembling a list of facts</a>. let me know if you find new facts. or new screenshots, for that matter.</p>
        <!--<p style="margin:0px;"><a href="https://www.bloomberg.com/opinion/articles/2023-11-21/openai-is-a-strange-nonprofit"> i was linked to by matt levine</a> (who fired sam altman market).</p>-->
        I am the <a href="https://aac.unicode.org/sponsors#bronze-1f4b9">proud owner</a> of the <span style="font-size:25px;">ðŸ’¹</span> emoji.</p>
    </div>

        <div class="column">
            <p>
            But thy eternal summer shall not fade,
            </p><p>
Nor lose possession of that fair thou owâ€™st;
</p><p>
Nor shall death brag thou wanderâ€™st in his shade,
</p><p>
When in eternal lines to time thou growâ€™st:
</p><p>
  So long as men can breathe or eyes can see,
</p><p>
  So long lives this, and this gives life to thee.
</div>
<div class="column">
    Reach out to me! Type in this box and hit enter and it will send me an email.
</div>
<div class="column">
    <textarea
    id="contact"
    placeholder="Type your message here. Press enter to submit. If you want me to respond, don't forget to include your contact information!"
    style="width: 100%; height: 100%;"
></textarea>
</div>

</div>

<div style="border-top: 1px solid grey; padding-bottom: 20px; border-bottom: 1px solid grey;">
    <div style="text-align: center; position: relative;">
      <p style="font-size: 4vh; margin: 10px 0;">
        Some things I'm thinking about.
      </p>

      <div style="position: absolute; left: 70%; top: 10px; font-size: 3vh;">
        <p style="margin: 0;">
          Current main interests
        </p>
        <p style="margin: 0;">
          <a href="#move" style="color: #00843D; font-weight: bold;">Moving well</a>,
          <span style="color: #BC002D; font-weight: bold;">How to design RL environments</span>,
          <span class="monasticism">Modern Monasticism</span>,
          <a href="#places" style="color: #9834eb; font-weight: bold;">Physical memory</a>
          <!-- Previous interests:
Catholicism
Energy systems
Computer memory technologies
GPU programming (somewhat current)
Parametric insurance
Nature of the US government subsidy of the mortgage market
-->
        </p>
        <abbr style="margin-top: 40px; font-size: 10px; color: grey;" title="WW2 strategic bombing campaigns
Meiji Restoration
Baseball
Tawhid
Catholicism
Energy systems
Computer memory technologies
GPU programming (somewhat current)
Performance engineering
Parametric insurance
Nature of the US government subsidy of the mortgage market
"> previous interests </abbr>
      </div>
    </div>

    <p style="font-size: 1.5vh; padding: 0px; color: grey;">
      click on the arrows to expand the content
    </p>
    <ol>
        <!--
        <li> <details> <summary> Systems that push risk to the limit </summary> There are certain classes of systems where when we endeavor to reduce the inherent riskiness of systems in order to then immediately plow that into some kind of fundamental risk/reward tradeoff.<br><br>In modern finance, a central insight is that a low-risk low-reward asset can be turned into a high-risk high-reward asset by just borrowing more money. A trade that is guaranteed to return 1% more than the treasuries is worth more than a risky one that returns on average 6% more than treasuries because the safer the investment is the more I can lever up. This is one of the central innovations of money managers to my mind, which is actually working hard to keep portfolio risk down which in turn means you can borrow much more.<br><br> There's a weirdly similar. dynamic in ML training where we want to make our learning rate as high as possible, but this makes our model training unstable. So we want our learning rate to be as high as possible without causing instability. The central insight of methods like shampoo is to "pre-condition" (get it) the gradient so it's less likely to become unstable as we increase the learning rate, which gain we immediately spend on increasing the learning rate and making training more unstable. </details> </li>
        -->
        <li> <details> <summary>What does it mean to be skilled?</summary> How does being skilled change you? Often the answer in history for why one group triumphed over another is the skill of a single person (Rockefeller, Napoleon, <a href="https://en.wikipedia.org/wiki/Enrico_Mattei">Enrico Mattei</a>), but <abbr title="except for generals">they rarely explain what that means</abbr>. Why was Rockefeller able to run more efficient refineries than any of his competitors? People often just say he was better, but what did that actually entail? One clue is that he actually looked at what expenses were and managed them in a way nobody else did at the time. I wish I understood this about everyone.<br><a href="https://x.com/rmbalt/status/1671951288483938331">Here's a small example of skill in making memes</a> -- the meme maker is so good the meme is *better* than the source material it draws from.</details> </li>
        <li> <details><summary>Why are some people and organizations more efficient than others with the same resources?</summary> The best example I have right now is Google's Ad organization vs Meta's Ad organization, where Meta is ~3 years behind due to, as far as I can tell, not believing in compute for several years (e.g. many of their production models are not just inferenced on CPU, but <i>trained</i> on CPU). Apparently this costs them ~20-40% of revenue. That's totally fucking insane! Tens of billions of dollars of lost opportunity. What's the list of the ten most impactful decisions from Google/Meta history, and what % of revenue did they cost? <!--How much does quality of execution like this actually matter? <a href="https://danluu.com/hardware-unforgiving/#2021-comments">Is it all just about PMF?</a> thinking about twitter vs facebook and the danluu post about how maybe it was because of poor execution--></details> </li>

        <li><details>
            <summary class="monasticism"> Working with intention </summary>
            
            <p style="margin: 0px;">
                Most people fall in to a career and default to working 40 hours/week for the rest of their lives and *then* think about how to spend the money.
            </p>
            <p style="margin: 0px;">
                I don't like working. Most people don't. I have structured my life to maximize freedom from the desires of others. It would be much better for you to have clear goals and intentions on how to live your life, and then choose your work to accomplish these goals with the least amount of pain. FIRE is a good example of this, though you can go much further.
            </p>
            <p style="margin: 0px;">
                A shining example of living with intention is groups like the <a href="https://www.carmelitemonks.org/">Carmelite monks of Wyoming</a>. If you look at <a href="https://www.carmelitemonkshorarium.org/">their schedule</a> they spend ~8 hours praying, 8 hours sleeping, and ~5.5 hours working (rest eating/recreation). Much of their work is devoted to the construction of <a href="https://www.youtube.com/watch?v=QxiwEEhcZX0">a massive Gothic church</a>. They make money from the outside world with <a href="https://www.mysticmonkcoffee.com/">Mystic Monk Coffee</a>.
            </p>
            <p style="margin: 0px;">
                They have specific goals in mind: communion with god, living in brotherhood, building beautiful things. They suborn themselves to commerce and the desires of others exactly as much as is necessary to accomplish those goals.
            </p>
            <p style="margin: 0px;">
                What would this look like for you? How could you live in brotherhood with your friends and build beautiful things together, like a family, or a village?
            </p>
        </details>
        </li>

        <li><details> <summary> The relationship between compute and intelligence </summary>
            <ol>
                <li> thinking longer in chess regularly improves your skill by ~50 elo for every doubling of time. That's incredible! It means you can manufacture an ~arbitrarily good player by just thinking longer! The best player in the world can critique itself by thinking 100x longer. </li>
                <li> Chess engines are typically architected as a search engine for the best move on top of an algorithm to evaluate how good a position is. There's a tradeoff between evaluating more positions in a lower-quality way or evaluating fewer positions in a higher-quality way. Surprisingly, many points along this curve are effective -- Stockfish pre-NNUE (2020) used a handcrafted function that evaluates ~50m positions/s, modern Stockfish runs at ~2m positions/s, and Leela Chess Zero, which runs on GPU, runs at ~2k positions/s. </li>
                <li> LLM tradeoffs between size and quality are interesting because the pareto frontier is moving so quickly. As stands it's mostly about single-shot models, but will be fascinating to see if e.g. agents can make a poor model a good one. </li>
                <li> In stock market trading, there's a relationship between latency and the complexity of signals. Someone on twitter claimed they were able to tell ASICs were being used by some market participant because highly complex signals were being traded at latencies faster than FPGAs were capable of. That's fascinating. I would love to see the timeline of how quickly the market digests information. How many "bps of alpha per ms" do we see the market improve by? </li>
                <!-- TODO: compression -->
            </ol>
        </details></li>
        <li> <details><summary>How does information diffuse through industries?</summary>I used to work in cloud infrastructure. Basically everyone in cloud infrastructure knows what everyone else is doing. Google not only published <a href="https://research.google/pubs/software-defined-far-memory-in-warehouse-scale-computers/">many</a> <a href="https://static.googleusercontent.com/media/research.google.com/en//archive/spanner-osdi2012.pdf">papers</a> <a href="https://research.google/pubs/the-datacenter-as-a-computer-an-introduction-to-the-design-of-warehouse-scale-machines/">on</a> <a href="https://research.google/pubs/cores-that-dont-count/">its</a> <a href="https://research.google/pubs/the-tail-at-scale/">infrastructure</a>, but open sourced much of it (k8s, t8w, j1x, b3l, p6f). Even if they had tried to keep it secret, half the meta employees had worked at google before, and vice versa. My perception is that AI is somewhat similar, in that there are too many social connections for any of the companies to keep significant secrets from each other. <br>To what degree are other industries this tight-knit? Is it advantageous or disadvantageous for industries to be like this? To what degree can secrets actually be kept in a whole industry? </details></li>
        <li> <details><summary>What exactly is the nature and amount of the federal government subsidies in the housing market?</summary>If you look at popular explanations of the government's role in the housing market, e.g. <a href="https://www.bitsaboutmoney.com/archive/mortgages-are-a-manufactured-product/">patio11's</a>, they say that there's an enormous government subsidy through the GSEs (Fannie Mae and Freddie Mac). As a summary for those who are unfamiliar, the GSEs take mortgages that meet some specifications and insure them against non-payment risk in return for a <a href="https://www.fhfa.gov/reports/single-family-guarantee-fees/2022">0.6% fee</a>. <a href="https://www.urban.org/sites/default/files/2024-03/Housing_Finance_At_A_Glance_Monthly_Chartbook_March_2024.pdf">2/3s</a> of mortgage debt in the US is insured in this manner. Mortgages that have been insured in this way trade at essentially the same price as US treasury debt, indicating the market believes the government will step in in case of significant non-payment, which seems true. But the GSEs are highly profitable (<a href="https://www.fanniemae.com/newsroom/fannie-mae-news/fourth-quarter-full-year-2023-financial-results">$2</a><a href="https://www.freddiemac.com/investors/financials/pdf/2023er-4q23_release.pdf">8B</a> in 2023) with enough assets (or enough assets after a few years years of retaining profits (which it doesn't do because treasury sweeps them)) to withstand even a 2008-level event. Many people think they could survive and do well as private companies and are trying to get the government to do this.<br>
        <b>So what exactly is the nature of the subsidy here?</b> My vague understanding is that the government gives

        <br>
        Relatedly, how are mortgage prices determined? As of today, 30-year mortgage rates are apparently 6.64%, but 30-year treasuries are 4.78%, so a 185 basis point difference.

        GSE fees/fee increases ~= taxes</details></li>
        <li> Why are execution units in CPUs not more randomly/evenly distributed among ports? </li>
        <li> How large are the implicit subsidies trucks get from road maintenance? Are they only cheaper than rail because of these subsidies? </li>
        <li> <details><summary><a href="https://x.com/cis_female/status/1790141729082864097">Why are retail options spreads so high? </a> </summary> My personal feeling is that spreads for any retail financial product should be essentially 0, because retail traders have no advantage (ignoring e.g. GME/AMC). But in fact we often see options spreads of 5% or more for options on relatively common stocks. Some of this is that Robinhood shows bid/ask numbers from exchanges and price improvement happens later (pointed out by @theemilyaccount). Another part is that retail options might go to an exchange more than retail stocks (though somehow robinhood made $150m last quarter on options revenue). My current theory is that internalizing retail options takes a lot of capital and skill, so there's less competition than for equities, which means spreads are wider and robinhood/market makers can take more of the price improvement. </details> </li>
        <li> <a href="graph.html">How expensive are various memory technologies per GB and per GB/S?</a> </li>
        <li> <details> <summary>Why do all my rust programs keep crashing? </summary>
            I don't use unsafe, and all my dependencies are really well known. They just keep fucking blowing up on me. It's absurd.
        </details>
        </li>
        <li> <details> <summary> Games I want to exist </summary>
            <ul>
                <li> Game where there's an entire fictional world populated by LLM-powered NPCs and your only means of interaction is to whisper in the internal monologues of the different characters once a day. How can you best persuade them?
                </li>
                <li> Kerbal Space Program for war, where you design weapons for a war and deal with improving technology over time, support the war effort as best you can, plan what materials you can use based on what can be conquered at various times, think about retooling, get confusing feedback from the people fighting at the front that you have to interpret
                </li>
        </details>
        </li>
        <li> What does it look like to optimize a model for reasoning? </li>
        <li> <details> <summary> Various small questions </summary>
            <ul>
                <li>
                    is "partisan politics evil, i wish everyone could just unite and do what's best for the country" a common brainworm outside the US?
                </li>
            </ul>
        </details> </li>
        <li> <details> <summary> Fun little product ideas: </summary>
            <ol>
                <li> Ski resort in Alaska where you buy a mountain and all the land nearby and only lease it out -- most value in ski resorts is land value, so if the resort was able to internalize this they would be able to afford much more amenities. </li>
                <li> Hyperscalers should spin out REITs to own the datacenter land/buildings </li>
                <li> <a href="https://x.com/cis_female/status/1811447447622697392">Parametric consumer disaster insurance</a> (on the BLOCKCHAIN) (because it's probably not legal otherwise) </li>
                <li> Conveyor belt tapas instead of conveyor belt sushi </li>
            </ol>
        </details>
        </li>
        <li> <details><summary>silly projects i <abbr title="want theoretically but probably won't do">want</abbr> to make</summary>
            <ol>
                <li> Ten rings, each of a different element (Samarium, Vanadium, Tungsten, etc.) </li>
                <li> buy 10KW of solar panels for ~$2k and have them arc through the air starting in the morning. use the power of the sun to rip the air apart </li>
                <li> A history of something -- a nation, a movement, a war, a company -- that actually takes numbers and statistics seriously, as something that drives the narrative instead of being a sidenote. Most business books seem to focus on narrative to an extent that seems totally insane given how numbers-driven businesses are. </li>
            </ol>
        </details>
        </li>
        <li>
            <details><summary>Previous questions that have been answered by viewers like you</summary>
            <ol>
                <li> Why are there regularly negative electricity prices in the US? Why don't people curtail more?</li>
                Basic answer is approximately "many plants are expensive to turn off for a short period of time" + production-based tax credits for wind and solar that encourage them to produce even when they have to pay money to do so.
            <li> Why did nuclear energy capacity factors go from <a href="https://www.energy.gov/sites/default/files/styles/full_article_width/public/2022-06/chart-title.png?itok=jorBkYE1">~70% to ~90% between 1990 and 2003</a>? </li>
            Answered by <a href="https://x.com/Vernon3Austin"> Austin Vernon </a>: "Nuclear power plant capacity factor went up because of countless small improvements, slightly modified equipment, better operations management, etc. Also NRC got more flexible with performance based regulation. [This] kind of performance increase is relatively normal for factories, chemical plants, and power plants."
            </ol>
        </details></li>
    </ol>
</div>

<div style="border-top: 1px solid grey;">
    <p style="font-size:25px; justify-content: center; text-align: center;">Some photos of me that I like.</p>
    <span>
    <canvas id="pointer" style="width: 400; height:400; position: absolute;"></canvas>
    <img id="family" loading="lazy" src="/sopics/family.jpeg" style="width: 400; height: 300;">
    </span>
    <img loading="lazy" src="/sopics/church.jpeg" style="max-height:400px">
    <img loading="lazy" src="/sopics/fire.jpeg" style="max-height:400px">
    <img loading="lazy" src="/sopics/parade.jpeg" style="max-height:400px">
    <img loading="lazy" src="/sopics/peace.jpeg" style="max-height:400px">
</div>

<div style="border-top: 1px solid grey; padding-bottom: 20px; display: flex;">
    <p style="font-size: 4vh; padding: 0px; margin: 10px; justify-content: center; text-align: center; writing-mode: sideways-lr; text-orientation: mixed; flex-shrink: 0;">Some songs I enjoy.</p>
    <ul style="flex: 1;">
        <li> <a href="https://www.youtube.com/watch?v=F_f00f0OVsc">Nearer To Thee</a>. It sweeps me away. It makes me feel one with the crowd. It makes me believe in god. </li>
        <li> <a href="https://www.youtube.com/watch?v=2HookiS1BmY">Clipo clipo</a>. It's feels insane that a song this deeply affecting is about a topic so obscure to me (apparently Ivorian independence). </li>
        <li> <a href="https://www.youtube.com/watch?v=28BFJ_TgiK8">Undone in sorrow</a>. Prototypical short story, played with candor. It feels like the sort of trap I could fall into, the song I could be singing. </li>
        <li> <a href="https://www.youtube.com/watch?v=A_4N05coN2g">Tumble in the Wind</a>. The songwriter's history strongly influences my understanding of songs like these. This man's life is full of tragedy and sorrow. This song is too. The beginning makes my heart sway, powerfully moves my chest to beat with him. Also <a href="https://www.youtube.com/watch?v=XzF09zbEbxI">Box Canyon</a> by him. </li>
        <li> <a href="https://www.youtube.com/watch?v=PC3eDwpVn6M">Fireflies Made Out of Dust</a>. I can't explain this one yet. </li>
        <li> <a href="https://www.youtube.com/watch?v=b_dO7sUZI9g">Western Island</a>. A real, compelling vision of a life of solitude. I could live on a western island. I need to feel the ground. </li>
        <li> <a href="https://www.youtube.com/watch?v=dTfmUAg0AGM"> Freak Show</a>. I find this song deeply disgusting. A connection to a world and a group of people I used to know. </li>
        <li> <a href="https://www.youtube.com/watch?v=BuNBLjJzRoo"> 90210 </a>. To me this song is about walking slick, rainy streets late at night without a friend for a thousand miles. </li>
        <li> <a href="https://www.youtube.com/watch?v=WVkD4lgXTEU"> Bones in the Ocean</a>. One of the songs I listened to <a href="/colorado.jpeg">wandering in Colorado</a>. I made a Finnish friend there, and then she said she wanted to kill all the rationalists. </li>
        <li> <a href="https://www.youtube.com/watch?v=c7khrDCCiHo"> Daddies</a>. Rocking, makes my body sway, brings me into the music.</li>
        <li> <a href="https://www.jefftk.com/solstice-2020/07-breaking-strain---bitter-wind--2020-12-20-020459.mp3"> Hymn to the Breaking Strain </a> Makes me feel like a human being. The recording is hauntingly off-kilter from the internet.
        </li>
        <li> <a href="https://x.com/bashu_thanks/status/1805350598918693329"> La NoyÃ©e </a> The pinnacle of energy, of life, of feeling </li>
    </ul>
</div>

<div style="border-top: 1px solid grey; padding-bottom: 20px;" id="places">
    <p style="font-size: 4vh; padding: 0px; margin: 10px; justify-content: center; text-align: center; flex-shrink: 0;">Places that mean something to me.</p>
    <!-- i want it to be a bunch of boxes with the text in the box and they are all kind of bumping in to each other -->
    <!-- would be cool to show physical locations -->
    <ul>
        <li>
            The top of Bernal Heights. Looking out over the twinkling lights. Seeing the purple lights, always in the same place. Taking off my clothes and giggling. Trying to climb the fence. Musing with my friends walking down to the rocky humps. Scampering in the darkness up the concrete-bag-ladder you're not supposed to touch.
        </li>
        <li>
            The walk between my house and the bus to go to work. A deeply hewn psychic path. Sprinting to try to make it. Getting the timing quite right.
        </li>
        <li>
            Walking down St. Charles street in New Orleans, feeling vague dread at how closed off the city is to me.
        </li>
        <li>
            Running through the woods outside school desperately trying to reason through whether I was trans. A season later sitting serenely in the snow.
        </li>
        <li>
            Scootering through Golden Gate Park on acid at new years daybreak, the colors unnaturally saturated, everything feeling too wonderful, wind streaming past my face.
        </li>
    </ul>
</div>

<div style="border-top: 1px solid grey; padding-bottom: 20px;" id="move">
    <p style="font-size: 4vh; padding: 0px; margin: 10px; justify-content: center; text-align: center;">Ways that I want to move.</p>
    <ul>
        <li>
            like Caroline Polachek in <a href="https://www.youtube.com/watch?v=sn3cHUtNZKo">this video</a>. In clear response to the beat, exact fluid, creative.
        </li>
        <li>
            "with maximum dependence on the other person's body"
        </li>
    </ul>
</div>

<!--
<div style="border-top: 1px solid grey; padding-bottom: 20px;">
    <p style="font-size: 4vh; padding: 0px; margin: 10px; justify-content: center; text-align: center;">Some other creative works I enjoyed.</p>
    <ul>
    <li>
    The Prize, Daniel Yergin
    </li>
    <li>
    The Blazing World
    </li>
    <li>
    The Wise Man's fear book series
    </li>
    <li>
    Jon Bois's videos
    </li>
    <li>
    Survivor
    </li>
    <li>
    Dan Luu's blog
    </li>
    </ul>
</div>
-->

<div style="border-top: 1px solid black; margin-top: 20px;">
    <h2> Some cool fish I saw in China </h2>
    <p> It's in a temple they said was a thousand years old but I'm pretty sure is from the 80s. </p>
    <video loop id="fish" height="600px" controls src="https://biggo.girl.surgery/fish2.mp4"></video>
</div>

    <script>
const can = document.getElementById("pointer");
const rect = can.getBoundingClientRect();
const dpr = window.devicePixelRatio || 1;
can.width = rect.width * dpr;
can.height = rect.height * dpr;
can.style.width = `${rect.width}px`;
can.style.height = `${rect.height}px`;

can.addEventListener("mousemove", event => {
    const rect = can.getBoundingClientRect();
    const mouseX = event.clientX - rect.left;
    const mouseY = event.clientY - rect.top;
})
const sopic_ctx = can.getContext("2d");
var centerX = 95*dpr;
var centerY = 180*dpr;

const radiusX = 30*dpr;
const radiusY = 45*dpr;
let angle = 0;

function drawArrow() {
    const arrowLength = 40;
    const arrowWidth = 15;

    const x = centerX + (radiusX + 20) * Math.cos(angle);
    const y = centerY + (radiusY + 20) * Math.sin(angle);

    // draw dot at center
    /*
    sopic_ctx.beginPath();
    sopic_ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
    sopic_ctx.fillStyle = "black";
    sopic_ctx.fill();
    sopic_ctx.closePath();
    */

    sopic_ctx.save();
    sopic_ctx.translate(x, y);
    sopic_ctx.rotate(Math.atan2(centerY - y, centerX - x));

    sopic_ctx.beginPath();
    sopic_ctx.moveTo(0, 0);
    sopic_ctx.lineTo(-arrowLength, -arrowWidth / 2);
    sopic_ctx.lineTo(-arrowLength, arrowWidth / 2);
    sopic_ctx.closePath();
    sopic_ctx.fillStyle = 'red';
    sopic_ctx.fill();

    sopic_ctx.restore();
}

function animate() {
    // this is kind of insane... maybe re
    sopic_ctx.clearRect(0, 0, 450*dpr, 337*dpr);

    // drawOval();
    drawArrow();

    angle += 0.02;
    if (angle > 2 * Math.PI) {
        angle -= 2 * Math.PI;
    }

    requestAnimationFrame(animate);
}

document.getElementById("family").onload = animate;

const months = [
    "Wisdom",
    "Temperance",
    "Beauty",
    "Lightness",
    "Diligence",
    "Humility",
    "Kindness",
    "Playfulness",
    "Truth",
    "Love",
    '<abbr title="my sister!">Lacey</abbr>',
    "Courage",
    "Mercy"
];

const gregorian_leap_year = gregorian_year => {
    if (gregorian_year%4 == 0) {
        if (gregorian_year%100 == 0) {
            if (gregorian_year%400 == 0) {
                return true;
            }
            return false;
        }
        return true;
    }
    return false;
}
const sophia_leap_year = sophia_year => {
    let leap_years = [0, 4, 8, 12, 16, 20, 24];
    return leap_years.includes(sophia_year);
}
const days_to_ymd = days_since_sophia => {
    if (days_since_sophia < 0) {
        throw "needs to be positive! no B.S.";
    }

    let day_in_year = days_since_sophia;
    let year = 0;
    while (day_in_year >= (365+sophia_leap_year(year))) {
        day_in_year -= 365;
        day_in_year -= sophia_leap_year(year);
        year += 1;
    }

    let month = "";
    let day_in_month = 0;
    const year_ordinal = ((year%10) == 1) ? "st" : ((year%10) == 2) ? "nd" : ((year%10) == 3) ? "rd" : "th";
    let year_string = `of the <span class="age">${year}${year_ordinal}</span> year of <span class="name">Sophia</span>`
    if (day_in_year == 0) {
        return "SOPHIA DAY!!! of " + year_string;
    } else if (sophia_leap_year(year) && (day_in_year >= (6*28+1))) {
        if (day_in_year == (6*28+1)) {
            return "Leap day of " + year_string;
        } else {
            month = months[Math.floor((day_in_year-2)/28)];
            day_in_month = (day_in_year-2)%28
        }
    } else {
        month = months[Math.floor((day_in_year-1)/28)];
        day_in_month = (day_in_year-1)%28;
    }
    const day = day_in_month+1;
    const day_ordinal = ((day%10) == 1) ? "st" : ((day%10) == 2) ? "nd" : ((day%10) == 3) ? "rd" : "th";

    return `the ${day}${day_ordinal} day of the month of ${month} in the <span class="age">${year}${year_ordinal}</span> year of <span class="name">Sophia</span>`;
}

/*
const clockDiv = document.getElementById('clock-goes-here');
const canvas = clock_canvas;

// npx -y wrangler pages deploy --project-name girlsurgery /Users/sophiawisdom/sophia_calendar
let time = "1:00PM April 8th";

// Set display size
canvas.style.width = '100px';
canvas.style.height = '100px';

// Set actual size in memory (scaled for retina)
canvas.width = 100 * dpr;
canvas.height = 100 * dpr;

// Add the date text
date.textContent = time.split(" ").slice(1).join(" ");

const ctx = canvas.getContext('2d');
ctx.scale(dpr, dpr);

// Draw clock face
centerX = 50;
centerY = 50;
const radius = 45;

// Draw outer circle
ctx.beginPath();
ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
ctx.strokeStyle = '#333';
ctx.lineWidth = 1;
ctx.stroke();

let am_pm = "AM";
if (time.includes("PM")) {
    am_pm = "PM";
}

// phtalo green (18, 53, 36)
ctx.font = "25px sans-serif";
ctx.fillStyle = "rgb(18, 100, 36)";
ctx.fillText(am_pm, 30, 40);

// Draw hour marks
for (let i = 0; i < 12; i++) {
    const angle = (i * Math.PI) / 6 - Math.PI / 2;
    const startRadius = radius - 4;
    const endRadius = radius - (i % 3 === 0 ? 8 : 5);

    ctx.beginPath();
    ctx.moveTo(
        centerX + Math.cos(angle) * startRadius,
        centerY + Math.sin(angle) * startRadius
    );
    ctx.lineTo(
        centerX + Math.cos(angle) * endRadius,
        centerY + Math.sin(angle) * endRadius
    );
    ctx.strokeStyle = '#666';
    ctx.lineWidth = i % 3 === 0 ? 1.5 : 1;
    ctx.stroke();
}

// Extract hours and minutes from time string
const [timeStr] = time.split(' ');
const [hours, minutesPart] = timeStr.split(':');
const minutes = parseInt(minutesPart);
const period = timeStr.slice(-2);
let hour = parseInt(hours);
if (period === 'PM' && hour !== 12) hour += 12;
if (period === 'AM' && hour === 12) hour = 0;

// Calculate angles
const hourAngle = ((hour % 12 + minutes / 60) * Math.PI / 6) - Math.PI / 2;
const minuteAngle = ((minutes) * Math.PI / 30) - Math.PI / 2;

// Hour hand
ctx.beginPath();
ctx.moveTo(centerX, centerY);
ctx.lineTo(
    centerX + Math.cos(hourAngle) * (radius * 0.5),
    centerY + Math.sin(hourAngle) * (radius * 0.5)
);
ctx.strokeStyle = '#333';
ctx.lineWidth = 2;
ctx.stroke();

// Minute hand
ctx.beginPath();
ctx.moveTo(centerX, centerY);
ctx.lineTo(
    centerX + Math.cos(minuteAngle) * (radius * 0.7),
    centerY + Math.sin(minuteAngle) * (radius * 0.7)
);
ctx.strokeStyle = '#666';
ctx.lineWidth = 1.5;
ctx.stroke();

// Center dot
ctx.beginPath();
ctx.arc(centerX, centerY, 2, 0, 2 * Math.PI);
ctx.fillStyle = '#333';
ctx.fill();
*/

    </script>
    <script async src="/movables.js"></script>



    <script>
const love = document.getElementById("love");

let w = window.innerWidth-10;
love.style.width = `${w}px`;
love.style.height = `${40}px`;

const worker = new Worker("offscreen_canvas.js");
const canvasLove = love.transferControlToOffscreen();
worker.postMessage({ love: canvasLove, dpr, w: window.innerWidth }, [canvasLove]);
window.addEventListener('resize', () => {
    let w = window.innerWidth-10;
    love.style.width = `${w}px`;
    love.style.height = `${40}px`;
    worker.postMessage({type: "resize", w, dpr});
});
    </script>


<script>
    const contact = document.getElementById("contact");
    const statusMessage = document.getElementById("status-message");

    contact.addEventListener("keydown", async function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault(); // Prevent default newline

            const message = this.value.trim();
            if (!message) return;

            // Disable textarea while sending
            this.disabled = true;
            // statusMessage.textContent = "Sending...";

            try {
                const response = await fetch("/email", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ message })
                });

                if (!response.ok) {
                    throw new Error(await response.text());
                }

                // statusMessage.textContent = "Message sent successfully!";
                this.value = ""; // Clear textarea
            } catch (error) {
                console.error("Error:", error);
                // statusMessage.textContent = "Failed to send message. Please try again.";
            } finally {
                this.disabled = false;
            }
        }
    });</script>
</div>
</html>
